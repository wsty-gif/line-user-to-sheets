(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2627)}])},2627:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Home}});var r=n(5893),o=n(7294),a=n(4155);function Home(){let[e,t]=(0,o.useState)([]),[n,c]=(0,o.useState)(""),[i,s]=(0,o.useState)(null);(0,o.useEffect)(()=>{console.log("aaa",i),fetch("/api/get-botname?account=".concat(i||1)).then(e=>e.json()).then(e=>{if(e.success){c(e.botName);let t=function(e){switch(e){case"株式会社TETOTE":return 1;case"mokara bridal etc.":return 3;default:return null}}(e.botName);s(t)}})},[]),(0,o.useEffect)(()=>{n&&fetch("/api/listRichMenus?botName=".concat(encodeURIComponent(n))).then(e=>e.json()).then(e=>console.log(e))},[n]),(0,o.useEffect)(()=>{fetch("/api/users").then(e=>e.json()).then(e=>{e.success&&t(e.users)})},[]);let handleRoleChange=(e,n)=>{t(t=>t.map(t=>t.id===e?{...t,role:n}:t))},handleUpdate=async()=>{let t=await fetch("/api/updateUsers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:e})}),n=await t.json();n.success?alert("更新完了"):alert("更新失敗")},u=e.filter(e=>e.botName===n),handleUpdateAndSetMenu=async()=>{for(let e of(await handleUpdate(),u)){let t=0;"株式会社TETOTE"===e.botName?t=1:"mokara bridal etc."===e.botName&&(t=3);let n="admin"===e.role?a.env["ADMIN_RICHMENU_ID_".concat(t)]:a.env["USER_RICHMENU_ID_".concat(t)],r=await fetch("/api/setRichMenu?userId=".concat(e.id,"&richMenuId=").concat(n)),o=await r.json();o.success||console.error("ユーザー ".concat(e.name," のリッチメニュー切替失敗"))}};return(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"ユーザー一覧"}),n&&(0,r.jsxs)("h2",{className:"text-lg font-medium mb-4",children:["ログイン中の公式LINEアカウント: ",n]}),(0,r.jsxs)("table",{className:"border-collapse border border-gray-400 w-full",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"bg-gray-200",children:[(0,r.jsx)("th",{className:"border border-gray-400 p-2",children:"名前"}),(0,r.jsx)("th",{className:"border border-gray-400 p-2",children:"役割"})]})}),(0,r.jsxs)("tbody",{children:[u.map(e=>(0,r.jsxs)("tr",{className:"bg-gray-50",children:[(0,r.jsx)("td",{className:"border border-gray-400 p-2",children:e.name}),(0,r.jsx)("td",{className:"border border-gray-400 p-2",children:(0,r.jsxs)("select",{value:e.role,onChange:t=>handleRoleChange(e.id,t.target.value),className:"border border-gray-300 rounded p-1",children:[(0,r.jsx)("option",{value:"user",children:"user"}),(0,r.jsx)("option",{value:"admin",children:"admin"})]})})]},e.id)),0===u.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:2,className:"border border-gray-400 p-2 text-center",children:"ユーザーが存在しません"})})]})]}),(0,r.jsx)("button",{onClick:handleUpdateAndSetMenu,className:"mt-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:"更新 & リッチメニュー切替"})]})}},4155:function(e){var t,n,r,o=e.exports={};function defaultSetTimout(){throw Error("setTimeout has not been defined")}function defaultClearTimeout(){throw Error("clearTimeout has not been defined")}function runTimeout(e){if(t===setTimeout)return setTimeout(e,0);if((t===defaultSetTimout||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){t=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();var a=[],c=!1,i=-1;function cleanUpNextTick(){c&&r&&(c=!1,r.length?a=r.concat(a):i=-1,a.length&&drainQueue())}function drainQueue(){if(!c){var e=runTimeout(cleanUpNextTick);c=!0;for(var t=a.length;t;){for(r=a,a=[];++i<t;)r&&r[i].run();i=-1,t=a.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];a.push(new Item(e,t)),1!==a.length||c||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=noop,o.addListener=noop,o.once=noop,o.off=noop,o.removeListener=noop,o.removeAllListeners=noop,o.emit=noop,o.prependListener=noop,o.prependOnceListener=noop,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);